# TestBuilderGenerator

**TestBuilderGenerator** is a C# Source Generator that automates the creation of builder classes for your entities,
streamlining the process of writing tests. By annotating a builder class with a specific attribute and specifying the
target class, the generator produces fluent builder methods, reducing boilerplate and enhancing test readability.

## âœ¨ Features

- **Fluent API**: Provides a fluent interface for setting property values, improving test clarity.
- **Integration with Incremental Generators**: Utilizes the latest C# Source Generator capabilities for efficient code
  generation.
- **Automatic Builder Generation**: Generates builder classes for your entities, including methods like
  `WithPropertyName` for each property.

```csharp
    // Example property
    public int PredefinedStructProp { get; set; }
    
    // Source generated Code
    public static int DefaultPredefinedStructProp { get; } = global::System.Random.Shared.Next();
    private int _predefinedStructProp = DefaultPredefinedStructProp;
    public EntityBuilder WithPredefinedStructProp(int predefinedStructProp)
    {
        _predefinedStructProp = predefinedStructProp;
        return this;
    }
```

- **Set own values instead of generated one**: If generated code doesn't match your needs, just put your version of
  default property or method, generator will skip it and respect your version

```csharp
public class Entity
{
    public int PredefinedStructProp { get; set; }
}

// User implemention
[TestBuilderGenOf<Entity>]
public partial class EntityBuilder
{
    // Override source generator
    public static int DefaultPredefinedStructProp { get; } = 99
    
    // Override source generator
    public EntityBuilder WithPredefinedStructProp(int val, bool random)
    {
        _predefinedStructProp = random ? val * val : val + 1;
        return this;
    }

    public partial Entity Build()
    {
        return new Entity(_predefinedStructProp);
    }
}

// Source generated code
public partial class EntityBuilder
{
    // Not generated, property with same Type and Name is already declared
    public static int DefaultPredefinedStructProp { get; } = global::System.Random.Shared.Next();
    
    // generated
    private int _predefinedStructProp = DefaultPredefinedStructProp;
    
    // Not generated, method with same return type and Name is already declared
    public EntityBuilder WithPredefinedStructProp(int predefinedStructProp)
    {
        _predefinedStructProp = predefinedStructProp;
        return this;
    }
    
    public static EntityBuilder Default => new EntityBuilder();
    public partial EntityNamespace.Entity Build();
}
```

- **Default Values**:
    - By default, all properties are initialized to `"default"` using the C# default operator.
    - For common types, more meaningful defaults are used to improve testability.

| Type                       | Default Value                |
|----------------------------|------------------------------|
| `int`                      | `Random.Shared.Next()`       |
| `float`                    | `Random.Shared.NextInt64()`  |
| `double`                   | `Random.Shared.NextSingle()` |
| `bool`                     | `false`                      |
| `Guid`                     | `Guid.NewGuid()`             |
| `DateTime`                 | `DateTime.UtcNow`            |
| `string`                   | `"Default{PropertyName}"`    |
| `Arrays/Lists/Collections` | `[]`                         |

- **Custom options**: Change way how code is generated by using MSBuild configuration

| Configuration Key                              | Behaviour                                            |
|------------------------------------------------|------------------------------------------------------|
| `TestBuilderGenerator_PrintDateTime`           | `Add creation date into generated fiele`             |
| `TestBuilderGenerator_UseBlockScopeNamespaces` | `Use block scoped namespaces instead of file scoped` |

## ðŸ“¦ Usage

- Add reference in your project to latest version of **TestBuilderGenerator** package

```csharp
 <PackageReference Include="TestBuilderGenerator" Version="1.6.1" />
```

[![NuGet](https://img.shields.io/nuget/v/TestBuilderGenerator.svg)](https://www.nuget.org/packages/TestBuilderGenerator)

- Create Builder partial class
- Add **TestBuilderGenOf<>** attribute
- Create implementation of Build method

```csharp
[TestBuilderGenOf<Entity>]
public partial class EntityBuilder
{
    public partial Entity Build()
    {
        return new Entity();
    }
}
```

## ðŸ”§ Generation examples

### Empty entity

```csharp
public class Entity
{
}

public partial class EntityBuilder
{
    public static EntityBuilder Default => new EntityBuilder();
    public partial EntityNamespace.Entity Build();
}
```

### Entity with properties

```csharp
public class Entity
{
    public int PredefinedStructProp { get; set; }
    public string PredefinedRefProp { get; set; }
}

public partial class EntityBuilder
{
    public static int DefaultPredefinedStructProp { get; } = global::System.Random.Shared.Next();
    private int _predefinedStructProp = DefaultPredefinedStructProp;
    public EntityBuilder WithPredefinedStructProp(int predefinedStructProp)
    {
        _predefinedStructProp = predefinedStructProp;
        return this;
    }

    public static string DefaultPredefinedRefProp { get; } = "DefaultPredefinedRefProp";
    private string _predefinedRefProp = DefaultPredefinedRefProp;
    public EntityBuilder WithPredefinedRefProp(string predefinedRefProp)
    {
        _predefinedRefProp = predefinedRefProp;
        return this;
    }

    public static EntityBuilder Default => new EntityBuilder();
    public partial EntityNamespace.Entity Build();
}

```
